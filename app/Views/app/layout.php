<?php

/**
 * @var ?\App\Models\Channel $channel
 * @var \App\Models\Channel[] $userChannels
 * @var \App\Models\User $currentUser
 */

?>

<?php ob_start() ?>

<div id="chat-content" data-user-id="<?= $currentUser->id ?>">
  <aside>
    <div class="top">
      <div class="header">
        <h1>Discussions</h1>

        <button id="create-channel" class="button icon">
          <!-- NotePencil -->
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M21.5306 5.46938L18.5306 2.46938C18.461 2.39964 18.3783 2.34432 18.2872 2.30658C18.1962 2.26884 18.0986 2.24941 18 2.24941C17.9014 2.24941 17.8038 2.26884 17.7128 2.30658C17.6217 2.34432 17.539 2.39964 17.4694 2.46938L8.46937 11.4694C8.39975 11.5391 8.34454 11.6218 8.3069 11.7129C8.26926 11.8039 8.24992 11.9015 8.25 12V15C8.25 15.1989 8.32902 15.3897 8.46967 15.5303C8.61032 15.671 8.80109 15.75 9 15.75H12C12.0985 15.7501 12.1961 15.7307 12.2871 15.6931C12.3782 15.6555 12.4609 15.6003 12.5306 15.5306L21.5306 6.53063C21.6004 6.46097 21.6557 6.37825 21.6934 6.28721C21.7312 6.19616 21.7506 6.09856 21.7506 6C21.7506 5.90144 21.7312 5.80384 21.6934 5.7128C21.6557 5.62175 21.6004 5.53903 21.5306 5.46938ZM11.6897 14.25H9.75V12.3103L15.75 6.31031L17.6897 8.25L11.6897 14.25ZM18.75 7.18969L16.8103 5.25L18 4.06031L19.9397 6L18.75 7.18969ZM21 12V19.5C21 19.8978 20.842 20.2794 20.5607 20.5607C20.2794 20.842 19.8978 21 19.5 21H4.5C4.10218 21 3.72064 20.842 3.43934 20.5607C3.15804 20.2794 3 19.8978 3 19.5V4.5C3 4.10218 3.15804 3.72064 3.43934 3.43934C3.72064 3.15804 4.10218 3 4.5 3H12C12.1989 3 12.3897 3.07902 12.5303 3.21967C12.671 3.36032 12.75 3.55109 12.75 3.75C12.75 3.94891 12.671 4.13968 12.5303 4.28033C12.3897 4.42098 12.1989 4.5 12 4.5H4.5V19.5H19.5V12C19.5 11.8011 19.579 11.6103 19.7197 11.4697C19.8603 11.329 20.0511 11.25 20.25 11.25C20.4489 11.25 20.6397 11.329 20.7803 11.4697C20.921 11.6103 21 11.8011 21 12Z"
              fill="currentColor" />
          </svg>
        </button>
      </div>

      <ul>
        <?php foreach ($userChannels as $ch): ?>
          <li>
            <a class="item" href="/channels/<?= $ch->id ?>" draggable="false"
              aria-current="<?= $channel && $channel->id === $ch->id ? 'page' : 'false' ?>">
              <div class="channel-name">
                <div class="icon">
                  <?php include __DIR__ . '/../../Icons/Hashtag.php'; ?>
                </div>
                <?= $ch->name ?>
              </div>
            </a>
          </li>
        <?php endforeach ?>
      </ul>
    </div>

    <div class="bottom">
      <ul>
        <li>
          <a class="item" href="/channels" draggable="false"
            aria-current="<?=
              $_SERVER['REQUEST_URI'] === '/channels' || !in_array($channel->id, array_map(fn($ch) => $ch->id, $userChannels)) ? 'page' : 'false' ?>">
            <div class="icon">
              <!-- Compass -->
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12 2.25C10.0716 2.25 8.18657 2.82183 6.58319 3.89317C4.97982 4.96451 3.73013 6.48726 2.99218 8.26884C2.25422 10.0504 2.06114 12.0108 2.43735 13.9021C2.81355 15.7934 3.74215 17.5307 5.10571 18.8943C6.46928 20.2579 8.20656 21.1865 10.0979 21.5627C11.9892 21.9389 13.9496 21.7458 15.7312 21.0078C17.5127 20.2699 19.0355 19.0202 20.1068 17.4168C21.1782 15.8134 21.75 13.9284 21.75 12C21.7473 9.41498 20.7192 6.93661 18.8913 5.10872C17.0634 3.28084 14.585 2.25273 12 2.25ZM12 20.25C10.3683 20.25 8.77326 19.7661 7.41655 18.8596C6.05984 17.9531 5.00242 16.6646 4.378 15.1571C3.75358 13.6496 3.5902 11.9908 3.90853 10.3905C4.22685 8.79016 5.01259 7.32015 6.16637 6.16637C7.32016 5.01259 8.79017 4.22685 10.3905 3.90852C11.9909 3.59019 13.6497 3.75357 15.1571 4.37799C16.6646 5.00242 17.9531 6.05984 18.8596 7.41655C19.7661 8.77325 20.25 10.3683 20.25 12C20.2475 14.1873 19.3775 16.2843 17.8309 17.8309C16.2843 19.3775 14.1873 20.2475 12 20.25ZM16.1644 6.82875L10.1644 9.82875C10.0193 9.90162 9.90162 10.0193 9.82875 10.1644L6.82875 16.1644C6.77151 16.2788 6.74448 16.4059 6.75022 16.5337C6.75596 16.6614 6.79429 16.7856 6.86156 16.8944C6.92882 17.0032 7.0228 17.093 7.13454 17.1552C7.24629 17.2175 7.3721 17.2501 7.5 17.25C7.61644 17.2498 7.73127 17.2229 7.83563 17.1713L13.8356 14.1713C13.9807 14.0984 14.0984 13.9807 14.1713 13.8356L17.1713 7.83563C17.242 7.69475 17.2666 7.53515 17.2415 7.3795C17.2164 7.22385 17.1429 7.08007 17.0314 6.96859C16.9199 6.85711 16.7762 6.7836 16.6205 6.75849C16.4649 6.73339 16.3053 6.75797 16.1644 6.82875ZM12.9375 12.9375L9.17719 14.8228L11.0625 11.0625L14.8266 9.18094L12.9375 12.9375Z"
                  fill="currentColor" />
              </svg>

            </div>
            Salons publics
          </a>
        </li>
        <li>
          <div class="item">
            <div class="icon">
              <!-- UserCircle -->
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12 2.25C10.0716 2.25 8.18657 2.82183 6.58319 3.89317C4.97982 4.96451 3.73013 6.48726 2.99218 8.26884C2.25422 10.0504 2.06114 12.0108 2.43735 13.9021C2.81355 15.7934 3.74215 17.5307 5.10571 18.8943C6.46928 20.2579 8.20656 21.1865 10.0979 21.5627C11.9892 21.9389 13.9496 21.7458 15.7312 21.0078C17.5127 20.2699 19.0355 19.0202 20.1068 17.4168C21.1782 15.8134 21.75 13.9284 21.75 12C21.7473 9.41498 20.7192 6.93661 18.8913 5.10872C17.0634 3.28084 14.585 2.25273 12 2.25ZM6.945 18.5156C7.48757 17.6671 8.23501 16.9688 9.11843 16.4851C10.0019 16.0013 10.9928 15.7478 12 15.7478C13.0072 15.7478 13.9982 16.0013 14.8816 16.4851C15.765 16.9688 16.5124 17.6671 17.055 18.5156C15.6097 19.6397 13.831 20.2499 12 20.2499C10.169 20.2499 8.39032 19.6397 6.945 18.5156ZM9 11.25C9 10.6567 9.17595 10.0766 9.5056 9.58329C9.83524 9.08994 10.3038 8.70542 10.852 8.47836C11.4001 8.2513 12.0033 8.19189 12.5853 8.30764C13.1672 8.4234 13.7018 8.70912 14.1213 9.12868C14.5409 9.54824 14.8266 10.0828 14.9424 10.6647C15.0581 11.2467 14.9987 11.8499 14.7716 12.3981C14.5446 12.9462 14.1601 13.4148 13.6667 13.7444C13.1734 14.0741 12.5933 14.25 12 14.25C11.2044 14.25 10.4413 13.9339 9.87868 13.3713C9.31607 12.8087 9 12.0456 9 11.25ZM18.165 17.4759C17.3285 16.2638 16.1524 15.3261 14.7844 14.7806C15.5192 14.2019 16.0554 13.4085 16.3184 12.5108C16.5815 11.6132 16.5582 10.6559 16.252 9.77207C15.9457 8.88825 15.3716 8.12183 14.6096 7.5794C13.8475 7.03696 12.9354 6.74548 12 6.74548C11.0646 6.74548 10.1525 7.03696 9.39044 7.5794C8.62839 8.12183 8.05432 8.88825 7.74805 9.77207C7.44179 10.6559 7.41855 11.6132 7.68157 12.5108C7.94459 13.4085 8.4808 14.2019 9.21563 14.7806C7.84765 15.3261 6.67147 16.2638 5.835 17.4759C4.77804 16.2873 4.0872 14.8185 3.84567 13.2464C3.60415 11.6743 3.82224 10.0658 4.47368 8.61478C5.12512 7.16372 6.18213 5.93192 7.51745 5.06769C8.85276 4.20346 10.4094 3.74367 12 3.74367C13.5906 3.74367 15.1473 4.20346 16.4826 5.06769C17.8179 5.93192 18.8749 7.16372 19.5263 8.61478C20.1778 10.0658 20.3959 11.6743 20.1543 13.2464C19.9128 14.8185 19.222 16.2873 18.165 17.4759Z"
                  fill="currentColor" />
              </svg>

            </div>
            <?= $currentUser->username ?>
          </div>
        </li>
      </ul>
    </div>
  </aside>

  <?= $slot ?>
</div>

<?php include 'CreateChannelDialog.php' ?>

<?php $content = ob_get_clean() ?>

<?php ob_start() ?>

<style data-file="channels/layout">
  #chat-content {
    display: grid;
    grid-template-columns: 350px 1fr;
    height: 100vh;
  }

  aside {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    justify-content: space-between;
    background-color: var(--color-surface);
    padding: 1rem 0.75rem;
    border-right: 1px solid var(--color-outline);
  }

  aside .top {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  aside .top .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 0.5rem;
  }

  aside ul {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  aside li {
    margin: 0;
  }

  aside .item {
    display: flex;
    text-decoration: none;
    gap: 0.5rem;
    padding: 0.75rem;
    border-radius: 0.75rem;
    user-select: none;
  }

  aside .item[aria-current="page"],
  aside .item:is(a):hover {
    background-color: var(--color-surface-variant);
  }

  aside .item .channel-name {
    display: flex;
    gap: 0.5rem;
    font-weight: 500;
  }
</style>

<?php $head = !isset($head) ? ob_get_clean() : $head . ob_get_clean(); ?>